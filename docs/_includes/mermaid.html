<script defer src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<script>
    (function () {
        function toMermaidDivs() {
            const codes = new Set();
            document.querySelectorAll('pre code.language-mermaid').forEach(c => codes.add(c));
            document.querySelectorAll('div.language-mermaid pre code').forEach(c => codes.add(c));
            document.querySelectorAll('code[data-lang="mermaid"]').forEach(c => codes.add(c));
            codes.forEach(code => {
                const wrapper = code.closest('.language-mermaid') || code.closest('pre') || code.parentElement;
                const div = document.createElement('div');
                div.className = 'mermaid';
                div.textContent = code.textContent;
                wrapper.replaceWith(div);
            });
        }
        function runMermaid() {
            if (!window.mermaid) { setTimeout(runMermaid, 50); return; }
            mermaid.initialize({ startOnLoad: false, securityLevel: 'loose' });
            mermaid.run({ querySelector: '.mermaid' });
        }
        function init(){ toMermaidDivs(); runMermaid(); }
        (document.readyState === 'loading') ? document.addEventListener('DOMContentLoaded', init) : init();
    })();
</script>
